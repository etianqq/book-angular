
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Injector · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="angularjs_part2_dirty_check.html" />
    
    
    <link rel="prev" href="angularjs_part2_DI.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="angularjs_part1.html">
            
                <a href="angularjs_part1.html">
            
                    
                    Angularjs基础知识
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1.1" data-path="angularjs_part1_intro.html">
            
                <a href="angularjs_part1_intro.html">
            
                    
                    概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.2" data-path="angularjs_part1_start.html">
            
                <a href="angularjs_part1_start.html">
            
                    
                    Angular启动过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.3" data-path="angularjs_part1_module.html">
            
                <a href="angularjs_part1_module.html">
            
                    
                    模块(module)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.4" data-path="angularjs_part1_scope.html">
            
                <a href="angularjs_part1_scope.html">
            
                    
                    作用域(scope)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.5" data-path="angularjs_part1_controller.html">
            
                <a href="angularjs_part1_controller.html">
            
                    
                    控制器(controller)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.6" data-path="angularjs_part1_expression.html">
            
                <a href="angularjs_part1_expression.html">
            
                    
                    表达式(expression)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.7" data-path="angularjs_part1.filter.html">
            
                <a href="angularjs_part1.filter.html">
            
                    
                    过滤器(filter)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.8" data-path="angularjs_part1_directive.html">
            
                <a href="angularjs_part1_directive.html">
            
                    
                    指令(directive)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.9" data-path="angularjs_part1_form.html">
            
                <a href="angularjs_part1_form.html">
            
                    
                    表单(form)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.10" data-path="angularjs_part1_route.html">
            
                <a href="angularjs_part1_route.html">
            
                    
                    路由(route)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.11" data-path="angularjs_part1_service.html">
            
                <a href="angularjs_part1_service.html">
            
                    
                    服务(service)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.1.12" data-path="angularjs_part1_xhr.html">
            
                <a href="angularjs_part1_xhr.html">
            
                    
                    XHR
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="angularjs_part2.html">
            
                <a href="angularjs_part2.html">
            
                    
                    进阶知识
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.2.1" data-path="angularjs_part2_load_module.html">
            
                <a href="angularjs_part2_load_module.html">
            
                    
                    模块加载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.2" data-path="angularjs_part2_DI.html">
            
                <a href="angularjs_part2_DI.html">
            
                    
                    依赖注入-DI
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.2.3" data-path="angularjs_part2_injector.html">
            
                <a href="angularjs_part2_injector.html">
            
                    
                    Injector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.4" data-path="angularjs_part2_dirty_check.html">
            
                <a href="angularjs_part2_dirty_check.html">
            
                    
                    脏检查机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.5" data-path="angularjs_part2_directive_lifecycle.html">
            
                <a href="angularjs_part2_directive_lifecycle.html">
            
                    
                    指令的生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.6" data-path="angularjs_part2_AOP.html">
            
                <a href="angularjs_part2_AOP.html">
            
                    
                    AOP机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.7" data-path="angularjs_part2_nested_form.html">
            
                <a href="angularjs_part2_nested_form.html">
            
                    
                    嵌套表单
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.8" data-path="angularjs_part2_tips.html">
            
                <a href="angularjs_part2_tips.html">
            
                    
                    杂项知识点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2.9" data-path="angularjs_part2_example.html">
            
                <a href="angularjs_part2_example.html">
            
                    
                    例子
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="angularjs_part3.html">
            
                <a href="angularjs_part3.html">
            
                    
                    设计模式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.3.1" data-path="angularjs_part3_oo.html">
            
                <a href="angularjs_part3_oo.html">
            
                    
                    面向对象的基本原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.2" data-path="angularjs_part3_IoC.html">
            
                <a href="angularjs_part3_IoC.html">
            
                    
                    控制反转
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3.3" data-path="angularjs_part3_decorator.html">
            
                <a href="angularjs_part3_decorator.html">
            
                    
                    装饰器模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Injector</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="injector">Injector</h1>
<p>&#x4F7F;&#x7528;apply&#x5B9E;&#x73B0;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;</p>
<h4 id="instance-injector">instance-Injector</h4>
<pre><code>return {
  invoke: invoke(fn, [self], [locals]),  // return none
  instantiate: instantiate(Type, [locals]),  // return &#x4E00;&#x4E2A;&#x65B0;&#x5B9E;&#x4F8B;
  get: get(name, [caller]), // return serivce&#x5B9E;&#x4F8B;
  annotate: annotate(fn, [strictDi]), //return Array: &#x4F9D;&#x8D56;&#x670D;&#x52A1;&#x7684;&#x540D;&#x5B57;
  has: function(name) {
    return providerCache.hasOwnProperty(name + providerSuffix) || cache.hasOwnProperty(name);
  }
};
</code></pre><h4 id="annotate">annotate</h4>
<p> &#x6709;3&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;annotate&#x51FD;&#x6570;&#xFF1A;</p>
<pre><code>// 1.&#x6309;&#x540D;&#x63A8;&#x65AD;&#x5F0F;&#x6CE8;&#x5165;
// inferred (only works if code not minified/obfuscated)
$injector.invoke(function(serviceA){});

// 2.$inject&#x6807;&#x8BB0;&#x5F0F;&#x58F0;&#x660E;&#x6CE8;&#x5165;
// annotated 
function explicit(serviceA) {};
explicit.$inject = [&apos;serviceA&apos;];
$injector.invoke(explicit);

// 3.&#x6570;&#x7EC4;&#x5185;&#x8054;&#x5F0F;&#x6CE8;&#x5165;
// inline 
$injector.invoke([&apos;serviceA&apos;, function(serviceA){}]);
</code></pre><p><img src="injector1.png" alt=""></p>
<h4 id="instantiate">instantiate</h4>
<p>&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x4F7F;&#x7528;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;</p>
<pre><code>  function instantiate(Type, locals) {
    var Constructor = function() {},instance, returnedValue;

    // Check if Type is annotated and use just the given function at n-1 as parameter
    Constructor.prototype = (isArray(Type) ? Type[Type.length - 1] : Type).prototype;
    instance = new Constructor();
    returnedValue = invoke(Type, instance, locals);

    return isObject(returnedValue) || isFunction(returnedValue) ? returnedValue : instance;
}
</code></pre><h4 id="the-twin-injectors">the twin injectors</h4>
<p>$injector&#x91CC;&#x9762;&#x662F;&#x6709;&#x4E24;&#x4E2A;injector&#x5BF9;&#x8C61;&#xFF1A;<strong>providerInjector</strong>&#x548C;<strong>instanceInjector</strong> &#x3002;&#x524D;&#x8005;&#x7528;&#x4E8E;config&#x9636;&#x6BB5;&#xFF0C;&#x540E;&#x8005;&#x7528;&#x4E8E;run&#x9636;&#x6BB5;&#x3002;</p>
<p>&#x4E5F;&#x53EF;&#x4EE5;&#x79F0;&#x4E3A;services and specialized objects&#xFF1A;</p>
<ul>
<li><p>Services are objects whose API is defined by the developer writing the service.</p>
</li>
<li><p>Specialized objects conform to a specific Angular framework API. These objects are one of controllers, directives, filters or animations.</p>
</li>
</ul>
<p>The injector needs to know how to create these objects. You tell it by registering a &quot;recipe&quot; for creating your object with the injector. There are five recipe types(<strong>Provider,Value, Factory, Service and Constant</strong>).</p>
<h4 id="provider">Provider</h4>
<p>You should use the Provider recipe only when you want to expose an API for application-wide configuration that must be made before the application starts. </p>
<p>This is usually interesting only for reusable services whose behavior might need to vary slightly between applications.</p>
<p>&#x5728;config&#x9636;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;provider service&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</p>
<h4 id="special-purpose-objects">Special Purpose Objects</h4>
<p>Earlier we mentioned that we also have special purpose objects that are different from services. These objects extend the framework as plugins and therefore must implement interfaces specified by Angular. These interfaces are <strong>Controller, Directive, Filter and Animation</strong>.</p>
<p>The instructions for the injector to create these special objects (<strong>with the exception of the Controller objects</strong>) use the <strong>Factory</strong> recipe behind the scenes.</p>
<p>Controller is instantiated via its constructor, so unlike services, <strong>controllers are not singletons</strong></p>
<h4 id="conclusion">Conclusion</h4>
<ul>
<li>The injector uses recipes to create two types of objects: <strong>services and special purpose objects</strong></li>
<li>There are five recipe types that define how to create objects: <strong>Value, Factory, Service, Provider and Constant</strong>.</li>
<li>Factory and Service are the most commonly used recipes. The only difference between them is that the Service recipe works better for objects of a custom type, while the Factory can produce JavaScript primitives and functions.</li>
<li>The <strong>Provider</strong> recipe is the <strong>core</strong> recipe type and all the other ones are just syntactic sugar on it.</li>
<li>Provider is the most complex recipe type. You don&apos;t need it unless you are building a reusable piece of code that needs global configuration.</li>
<li>All special purpose objects except for the Controller are defined via Factory recipes.</li>
</ul>
<p>&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.angularjs.org/guide/providers" target="_blank">Provider</a> <a href="https://docs.angularjs.org/api/auto/service/$injector" target="_blank">$injector</a>
&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF1A;<a href="http://taoofcode.net/studying-the-angular-injector/" target="_blank">Studying the Angular JS Injector</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="angularjs_part2_DI.html" class="navigation navigation-prev " aria-label="Previous page: 依赖注入-DI">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="angularjs_part2_dirty_check.html" class="navigation navigation-next " aria-label="Next page: 脏检查机制">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Injector","level":"1.1.2.3","depth":3,"next":{"title":"脏检查机制","level":"1.1.2.4","depth":3,"path":"angularjs_part2_dirty_check.md","ref":"angularjs_part2_dirty_check.md","articles":[]},"previous":{"title":"依赖注入-DI","level":"1.1.2.2","depth":3,"path":"angularjs_part2_DI.md","ref":"angularjs_part2_DI.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"angularjs_part2_injector.md","mtime":"2019-09-20T07:30:18.771Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-09-20T07:33:46.290Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

